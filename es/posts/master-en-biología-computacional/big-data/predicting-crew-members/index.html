<!doctype html><html><head><title>Predicting Crew Members</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/layouts/main.css><link rel=stylesheet href=/css/navigators/navbar.css><link rel=stylesheet href=/css/plyr.css><link rel=stylesheet href=/css/flag-icon.min.css><link rel=stylesheet href=/google-fonts/Mulish/mulish.css><link rel=stylesheet href=/fontawesome/css/all.min.css><link rel=stylesheet href=/css/colortheme/colortheme.css><link rel=icon type=image/png href=/images/new-favicon_hucdd21eecb8229141dd7886643601b174_45610_42x0_resize_box_3.png><meta property="og:title" content="Predicting Crew Members"><meta property="og:description" content="Your job is to create a regression model that will help predict how many crew members will be needed for future ships. In other words, use the features you think will be useful to predict the value in the Crew column.
Create the Spark Session !apt-get install openjdk-8-jdk-headless -qq > /dev/null !wget -q https://mirrors.sonic.net/apache/spark/spark-3.1.2/spark-3.1.2-bin-hadoop3.2.tgz !tar xzf spark-3.1.2-bin-hadoop3.2.tgz !pip install -q findspark import os os.environ[&#34;JAVA_HOME&#34;] = &#34;/usr/lib/jvm/java-8-openjdk-amd64&#34; os.environ[&#34;SPARK_HOME&#34;] = &#34;/content/spark-3.1.2-bin-hadoop3.2&#34; import findspark findspark."><meta property="og:type" content="article"><meta property="og:url" content="https://www.pablomarcos.me/es/posts/master-en-biolog%C3%ADa-computacional/big-data/predicting-crew-members/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-10-26T00:00:00+00:00"><meta property="article:modified_time" content="2021-10-26T00:00:00+00:00"><meta name=description content="Predicting Crew Members"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/css/layouts/single.css><link rel=stylesheet href=/css/navigators/sidebar.css><link rel=stylesheet href=/css/style.css><script src=https://cdn.counter.dev/script.js data-id=counter-analytics@loreak.org data-utcoffset=1></script>
<script data-goatcounter=https://n9zp7.goatcounter.com/count async src=/js/goat-counter.js></script></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/es><img src=/images/main-logo_hu47450349114826056e2be89059cb78d7_20725_42x0_resize_box_3.png alt=Logo>
Pablo Marcos' Blog</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"><li class="nav-item dropdown"><div id=theme-initialization style=display:none default-theme=system></div><a class="nav-link dropdown-toggle" href=# id=themeSelector role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><img id=navbar-theme-icon-svg src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme"></a><div class="dropdown-menu dropdown-menu-icons-only" aria-labelledby=themeSelector><a class="dropdown-item nav-link" href=# onclick=enableLightTheme()><img class=menu-icon-center src=/icons/sun-svgrepo-com.svg width=20 alt="Light Theme"></a>
<a class="dropdown-item nav-link" href=# onclick=enableDarkTheme()><img class=menu-icon-center src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme"></a>
<a class="dropdown-item nav-link" href=# onclick=useSystemTheme()><img class=menu-icon-center src=/icons/computer-svgrepo-com.svg width=20 alt="System Theme"></a></div></li></ul></div></div><img src=/images/main-logo_hu47450349114826056e2be89059cb78d7_20725_42x0_resize_box_3.png class=d-none id=main-logo alt=Logo>
<img src=/images/inverted-logo_hu54cab9b231ca4636ef2fd30ef75af799_11321_42x0_resize_box_3.png class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/es/search><input type=text name=keyword placeholder=Búsqueda data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/es/posts/ data-filter=all>Posts</a></li><div class=subtree><li><i class="fas fa-plus-circle"></i><a href=/es/posts/concursos/>Concursos</a><ul><li><a href=/es/posts/concursos/centrodelenguas/ title="Centro de Lenguas 2020">Centro de Lenguas 2020</a></li><li><a href=/es/posts/concursos/vinoyaceite2020/ title="Etiquetas ETSIAAB 2020">Etiquetas ETSIAAB 2020</a></li><li><i class="fas fa-plus-circle"></i><a href=/es/posts/concursos/season-of-kde-2021/>Season of KDE 2021</a><ul><li><a href=/es/posts/concursos/season-of-kde-2021/sok-final-status-report/ title="Informe Final">Informe Final</a></li><li><a href=/es/posts/concursos/season-of-kde-2021/sok-report-april/ title="SoK 2021 Abril">SoK 2021 Abril</a></li><li><a href=/es/posts/concursos/season-of-kde-2021/sok-report-january/ title="SoK 2021 Enero">SoK 2021 Enero</a></li><li><a href=/es/posts/concursos/season-of-kde-2021/sok-report-february/ title="SoK 2021 Febrero">SoK 2021 Febrero</a></li><li><a href=/es/posts/concursos/season-of-kde-2021/sok-report-march/ title="SoK 2021 Marzo">SoK 2021 Marzo</a></li></ul></li><li><a href=/es/posts/concursos/season-of-kde-2022/ title="Season of KDE 2022">Season of KDE 2022</a></li></ul></li><li><i class="fas fa-minus-circle"></i><a class=active href=/es/posts/master-en-biolog%C3%ADa-computacional/>Master en Bioinformática</a><ul class=active><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/readme/ title=README>README</a></li><li><i class="fas fa-minus-circle"></i><a class=active href=/es/posts/master-en-biolog%C3%ADa-computacional/big-data/>Big Data</a><ul class=active><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/big-data/predicting-dog-food-spoiling/ title="Dog Food Spoiling">Dog Food Spoiling</a></li><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/big-data/dog-food-day/ title="Extra Point">Extra Point</a></li><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/big-data/hack-data/ title="Hack Data">Hack Data</a></li><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/big-data/predicting-churn-risk/ title="Predicting Churn Risk">Predicting Churn Risk</a></li><li><a class=active href=/es/posts/master-en-biolog%C3%ADa-computacional/big-data/predicting-crew-members/ title="Predicting Crew Members">Predicting Crew Members</a></li><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/big-data/walmart-stock-exercise/ title="Walmart Stock Exercise">Walmart Stock Exercise</a></li><li><i class="fas fa-plus-circle"></i><a href=/es/posts/master-en-biolog%C3%ADa-computacional/big-data/final-project/>Final Project</a><ul><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/big-data/final-project/annex-i-code/ title="Annex I - Code">Annex I - Code</a></li><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/big-data/final-project/paper/ title=ReadMe>ReadMe</a></li></ul></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/es/posts/master-en-biolog%C3%ADa-computacional/biolog%C3%ADa-evolutiva/>Biología Evolutiva</a><ul><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/biolog%C3%ADa-evolutiva/exercise-1/ title="Exercise 1">Exercise 1</a></li><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/biolog%C3%ADa-evolutiva/exercise-2/ title="Exercise 2">Exercise 2</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/es/posts/master-en-biolog%C3%ADa-computacional/biolog%C3%ADa-programable/>Biología Programable</a><ul><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/biolog%C3%ADa-programable/essay/ title=Essay>Essay</a></li><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/biolog%C3%ADa-programable/presentation/ title=Presentation>Presentation</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/es/posts/master-en-biolog%C3%ADa-computacional/estad%C3%ADstica/>Estadística</a><ul><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/estad%C3%ADstica/assignment-1/ title="Assignment 1">Assignment 1</a></li><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/estad%C3%ADstica/assignment-2/ title="Assignment 2">Assignment 2</a></li><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/estad%C3%ADstica/assignment-3/ title="Assignment 3">Assignment 3</a></li><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/estad%C3%ADstica/lecture-notes/ title="Notas de Clase">Notas de Clase</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/es/posts/master-en-biolog%C3%ADa-computacional/gab/>GAB</a><ul><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/gab/assignment-1/ title="Assignment 1">Assignment 1</a></li><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/gab/assignment-2/ title="Assignment 2">Assignment 2</a></li><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/gab/warning/ title=WARNING>WARNING</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/es/posts/master-en-biolog%C3%ADa-computacional/gdav/>GDAV</a><ul><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/gdav/final-project/ title="Final Project">Final Project</a></li><li><i class="fas fa-plus-circle"></i><a href=/es/posts/master-en-biolog%C3%ADa-computacional/gdav/single-cell-genomics/>Single Cell Genomics</a><ul><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/gdav/single-cell-genomics/exercise-1/ title="Exercise 1">Exercise 1</a></li><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/gdav/single-cell-genomics/exercise-2/ title="Exercise 2">Exercise 2</a></li><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/gdav/single-cell-genomics/exercise-3/ title="Exercise 3">Exercise 3</a></li><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/gdav/single-cell-genomics/final-report/ title="Final Report">Final Report</a></li></ul></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/es/posts/master-en-biolog%C3%ADa-computacional/knowledge-representation/>Knowledge Representation</a><ul><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/knowledge-representation/paper/ title=Paper>Paper</a></li><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/knowledge-representation/presentation/ title=Presentation>Presentation</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/es/posts/master-en-biolog%C3%ADa-computacional/lead-discovery/>Lead Discovery</a><ul><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/lead-discovery/annex-i-code/ title="Annex I - Code">Annex I - Code</a></li><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/lead-discovery/assignment-1/ title="Assignment 1">Assignment 1</a></li><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/lead-discovery/assignment-2/ title="Assignment 2">Assignment 2</a></li><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/lead-discovery/assignment-3/ title="Assignment 3">Assignment 3</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/es/posts/master-en-biolog%C3%ADa-computacional/bioinfo-programming-challenges/>Retos en Ruby</a><ul><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/bioinfo-programming-challenges/assignment-1/ title="Assignment 1">Assignment 1</a></li><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/bioinfo-programming-challenges/assignment-2/ title="Assignment 2">Assignment 2</a></li><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/bioinfo-programming-challenges/assignment-3/ title="Assignment 3">Assignment 3</a></li><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/bioinfo-programming-challenges/assignment-4/ title="Assignment 4">Assignment 4</a></li><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/bioinfo-programming-challenges/assignment-5/ title="Assignment 5">Assignment 5</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/es/posts/master-en-biolog%C3%ADa-computacional/tfm/>Trabajo Fin de Master</a><ul><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/tfm/cangraph-documentation/ title="CanGraph Documentation">CanGraph Documentation</a></li><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/tfm/cangraph-update/ title="CanGraph Update">CanGraph Update</a></li><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/tfm/ecsa-day-2022/ title="ECSA Day 2022">ECSA Day 2022</a></li><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/tfm/presentation/ title=Presentación>Presentación</a></li><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/tfm/thesis/ title=Tesis>Tesis</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/es/posts/master-en-biolog%C3%ADa-computacional/modelizaci%C3%B3n-de-sistemas-biol%C3%B3gicos/>Modelización</a><ul><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/modelizaci%C3%B3n-de-sistemas-biol%C3%B3gicos/celular-automata/ title="Cellular Automata">Cellular Automata</a></li><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/modelizaci%C3%B3n-de-sistemas-biol%C3%B3gicos/seir-modified-model/ title="CoViD and Lockdowns">CoViD and Lockdowns</a></li><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/modelizaci%C3%B3n-de-sistemas-biol%C3%B3gicos/networks/ title=Erdös-Rényi>Erdös-Rényi</a></li><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/modelizaci%C3%B3n-de-sistemas-biol%C3%B3gicos/essay-on-free-will/ title="Essay on Free Will">Essay on Free Will</a></li><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/modelizaci%C3%B3n-de-sistemas-biol%C3%B3gicos/kuramoto-oscilators/ title="Kuramoto Oscilators">Kuramoto Oscilators</a></li><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/modelizaci%C3%B3n-de-sistemas-biol%C3%B3gicos/logistic-map/ title="Logistic Map">Logistic Map</a></li><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/modelizaci%C3%B3n-de-sistemas-biol%C3%B3gicos/beyond-erdos-renyi/ title="Preferential Attachment">Preferential Attachment</a></li><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/modelizaci%C3%B3n-de-sistemas-biol%C3%B3gicos/synchronization-of-fireflies/ title="Synchronization of Fireflies">Synchronization of Fireflies</a></li><li><a href=/es/posts/master-en-biolog%C3%ADa-computacional/modelizaci%C3%B3n-de-sistemas-biol%C3%B3gicos/sir-model/ title="The SIR Model">The SIR Model</a></li></ul></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/es/posts/poesia/>Poesía</a><ul><li><a href=/es/posts/poesia/abrazo/ title=Abrazo>Abrazo</a></li><li><a href=/es/posts/poesia/invierno/ title="Ahora soy Invierno">Ahora soy Invierno</a></li><li><a href=/es/posts/poesia/amor/ title=Amor>Amor</a></li><li><a href=/es/posts/poesia/despedida/ title=Amor>Amor</a></li><li><a href=/es/posts/poesia/simetria/ title=Asimetrico>Asimetrico</a></li><li><a href=/es/posts/poesia/paso-de-cebra/ title="Atrévete a Cruzar">Atrévete a Cruzar</a></li><li><a href=/es/posts/poesia/a%C3%B1o-nuevo/ title="Año Nuevo">Año Nuevo</a></li><li><a href=/es/posts/poesia/cerezo/ title=Cerezo>Cerezo</a></li><li><a href=/es/posts/poesia/locos/ title="Ciegos y Locos">Ciegos y Locos</a></li><li><a href=/es/posts/poesia/ciudad/ title=Ciudad>Ciudad</a></li><li><a href=/es/posts/poesia/coincidencia/ title=Coincidencia>Coincidencia</a></li><li><a href=/es/posts/poesia/peligro/ title="Colisión Inminente">Colisión Inminente</a></li><li><a href=/es/posts/poesia/courage/ title=Coraje>Coraje</a></li><li><a href=/es/posts/poesia/david-revoy/ title="Cute Cats">Cute Cats</a></li><li><a href=/es/posts/poesia/eclipse/ title=Eclipse>Eclipse</a></li><li><a href=/es/posts/poesia/efecto-pigmalion/ title="Efecto Pigmalión">Efecto Pigmalión</a></li><li><a href=/es/posts/poesia/efimero/ title=Efímero>Efímero</a></li><li><a href=/es/posts/poesia/espinas/ title=Espinas>Espinas</a></li><li><a href=/es/posts/poesia/estro/ title=Estro>Estro</a></li><li><a href=/es/posts/poesia/fuego/ title="Fuego 🔥 🔥">Fuego 🔥 🔥</a></li><li><a href=/es/posts/poesia/fugaz/ title=Fugaz>Fugaz</a></li><li><a href=/es/posts/poesia/ginko/ title=Gingko>Gingko</a></li><li><a href=/es/posts/poesia/granada/ title=Granada>Granada</a></li><li><a href=/es/posts/poesia/guayaba/ title=Guayaba>Guayaba</a></li><li><a href=/es/posts/poesia/hechizo/ title=Hechizo>Hechizo</a></li><li><a href=/es/posts/poesia/hipocresia/ title=Hipocresía>Hipocresía</a></li><li><a href=/es/posts/poesia/horizontes/ title=Horizontes>Horizontes</a></li><li><a href=/es/posts/poesia/if-ants-rose-up/ title="If ants rose up">If ants rose up</a></li><li><a href=/es/posts/poesia/incertidumbre/ title=Incertidumbre>Incertidumbre</a></li><li><a href=/es/posts/poesia/introduccion/ title=Introducción>Introducción</a></li><li><a href=/es/posts/poesia/hermanos/ title="La Revolución">La Revolución</a></li><li><a href=/es/posts/poesia/metamorfosis/ title=Metamorfosis>Metamorfosis</a></li><li><a href=/es/posts/poesia/miedo/ title=Miedo>Miedo</a></li><li><a href=/es/posts/poesia/monta%C3%B1a-rusa/ title="Montaña Rusa">Montaña Rusa</a></li><li><a href=/es/posts/poesia/narciso/ title=Narciso>Narciso</a></li><li><a href=/es/posts/poesia/ojala/ title=Ojalá>Ojalá</a></li><li><a href=/es/posts/poesia/erase/ title="Once Upon a Time">Once Upon a Time</a></li><li><a href=/es/posts/poesia/orquesta/ title="Orquesta 🎻 🎺">Orquesta 🎻 🎺</a></li><li><a href=/es/posts/poesia/papel/ title=Papel>Papel</a></li><li><a href=/es/posts/poesia/philanthropy/ title=Philantropy>Philantropy</a></li><li><a href=/es/posts/poesia/pluma/ title=Plumas>Plumas</a></li><li><a href=/es/posts/poesia/pluton/ title=Plutón>Plutón</a></li><li><a href=/es/posts/poesia/mitologia/ title="Por fin, la Primavera">Por fin, la Primavera</a></li><li><a href=/es/posts/poesia/precipicio/ title=Precipicio>Precipicio</a></li><li><a href=/es/posts/poesia/pajaro/ title=Pájaro>Pájaro</a></li><li><a href=/es/posts/poesia/rarezas/ title=Rarezas>Rarezas</a></li><li><a href=/es/posts/poesia/reloj/ title=Reloj>Reloj</a></li><li><a href=/es/posts/poesia/renacer/ title=Renacer>Renacer</a></li><li><a href=/es/posts/poesia/rubato/ title=Rubato>Rubato</a></li><li><a href=/es/posts/poesia/simulaci%C3%B3n/ title=Simulación>Simulación</a></li><li><a href=/es/posts/poesia/soledad/ title=Soledad>Soledad</a></li><li><a href=/es/posts/poesia/sue%C3%B1o/ title=Sueño>Sueño</a></li><li><a href=/es/posts/poesia/sufragettes/ title=Sufragettes>Sufragettes</a></li><li><a href=/es/posts/poesia/tarde/ title=Tarde>Tarde</a></li><li><a href=/es/posts/poesia/teclado/ title=Teclado>Teclado</a></li><li><a href=/es/posts/poesia/tentacion/ title=Tentación>Tentación</a></li><li><a href=/es/posts/poesia/valor/ title=Valor>Valor</a></li><li><a href=/es/posts/poesia/verde/ title=Verde>Verde</a></li><li><a href=/es/posts/poesia/volver/ title=Volver>Volver</a></li><li><a href=/es/posts/poesia/basta/ title="Ya Basta">Ya Basta</a></li><li><a href=/es/posts/poesia/egoismo/ title=Egoísmo>Egoísmo</a></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(/es/posts/master-en-biolog%C3%ADa-computacional/big-data/predicting-crew-members/hero.jpg)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/author/avataaars_hu2c0487d45d6329fb914c802e2a63f853_31315_120x120_fit_box_3.png alt="Author Image"><h5 class=author-name>Pablo Ignacio Marcos López</h5><p>martes, 26 de octubre de 2021</p></div><div class=title><h1>Predicting Crew Members</h1></div><div class=taxonomy-terms><ul style=padding-left:0></ul></div><div class=post-content id=post-content><p>Your job is to create a regression model that will help predict how many crew members will be needed for future ships. In other words, use the features you think will be useful to predict the value in the Crew column.</p><div style=text-align:center><a href=./Predicting_Crew_Members.ipynb target=_parent><img src=/posts/Imagenes/jupyter-badge.svg align=center width=20%></a></div><h4 id=create-the-spark-session>Create the Spark Session</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>!</span>apt<span style=color:#f92672>-</span>get install openjdk<span style=color:#f92672>-</span><span style=color:#ae81ff>8</span><span style=color:#f92672>-</span>jdk<span style=color:#f92672>-</span>headless <span style=color:#f92672>-</span>qq <span style=color:#f92672>&gt;</span> <span style=color:#f92672>/</span>dev<span style=color:#f92672>/</span>null
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>!</span>wget <span style=color:#f92672>-</span>q https:<span style=color:#f92672>//</span>mirrors<span style=color:#f92672>.</span>sonic<span style=color:#f92672>.</span>net<span style=color:#f92672>/</span>apache<span style=color:#f92672>/</span>spark<span style=color:#f92672>/</span>spark<span style=color:#f92672>-</span><span style=color:#ae81ff>3.1.2</span><span style=color:#f92672>/</span>spark<span style=color:#f92672>-</span><span style=color:#ae81ff>3.1.2</span><span style=color:#f92672>-</span>bin<span style=color:#f92672>-</span>hadoop3<span style=color:#ae81ff>.2</span><span style=color:#f92672>.</span>tgz
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>!</span>tar xzf spark<span style=color:#f92672>-</span><span style=color:#ae81ff>3.1.2</span><span style=color:#f92672>-</span>bin<span style=color:#f92672>-</span>hadoop3<span style=color:#ae81ff>.2</span><span style=color:#f92672>.</span>tgz
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>!</span>pip install <span style=color:#f92672>-</span>q findspark
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span>os<span style=color:#f92672>.</span>environ[<span style=color:#e6db74>&#34;JAVA_HOME&#34;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/usr/lib/jvm/java-8-openjdk-amd64&#34;</span>
</span></span><span style=display:flex><span>os<span style=color:#f92672>.</span>environ[<span style=color:#e6db74>&#34;SPARK_HOME&#34;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/content/spark-3.1.2-bin-hadoop3.2&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> findspark
</span></span><span style=display:flex><span>findspark<span style=color:#f92672>.</span>init()
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pyspark.sql <span style=color:#f92672>import</span> SparkSession
</span></span><span style=display:flex><span>spark <span style=color:#f92672>=</span> SparkSession<span style=color:#f92672>.</span>builder<span style=color:#f92672>.</span>master(<span style=color:#e6db74>&#34;local[*]&#34;</span>)<span style=color:#f92672>.</span>getOrCreate()
</span></span></code></pre></div><h4 id=read-the-file-and-inspect-it>Read the file and inspect it</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#Please drop the file in the environments &#39;Files&#39; panel</span>
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> spark<span style=color:#f92672>.</span>read<span style=color:#f92672>.</span>options(header<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;true&#34;</span>, inferSchema<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;true&#34;</span>)<span style=color:#f92672>.</span>csv(<span style=color:#e6db74>&#34;/content/cruise_ship_info.csv&#34;</span>)
</span></span><span style=display:flex><span>df<span style=color:#f92672>.</span>describe()<span style=color:#f92672>.</span>toPandas()
</span></span></code></pre></div><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}<pre><code>.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</code></pre><p></style></p><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>summary</th><th>Ship_name</th><th>Cruise_line</th><th>Age</th><th>Tonnage</th><th>passengers</th><th>length</th><th>cabins</th><th>passenger_density</th><th>crew</th></tr></thead><tbody><tr><th>0</th><td>count</td><td>158</td><td>158</td><td>158</td><td>158</td><td>158</td><td>158</td><td>158</td><td>158</td><td>158</td></tr><tr><th>1</th><td>mean</td><td>Infinity</td><td>None</td><td>15.689873417721518</td><td>71.28467088607599</td><td>18.45740506329114</td><td>8.130632911392404</td><td>8.830000000000005</td><td>39.90094936708861</td><td>7.794177215189873</td></tr><tr><th>2</th><td>stddev</td><td>None</td><td>None</td><td>7.615691058751413</td><td>37.229540025907866</td><td>9.677094775143416</td><td>1.793473548054825</td><td>4.4714172221480615</td><td>8.63921711391542</td><td>3.503486564627034</td></tr><tr><th>3</th><td>min</td><td>Adventure</td><td>Azamara</td><td>4</td><td>2.329</td><td>0.66</td><td>2.79</td><td>0.33</td><td>17.7</td><td>0.59</td></tr><tr><th>4</th><td>max</td><td>Zuiderdam</td><td>Windstar</td><td>48</td><td>220.0</td><td>54.0</td><td>11.82</td><td>27.0</td><td>71.43</td><td>21.0</td></tr></tbody></table></div><h4 id=indexing-non-numeric-parameters>Indexing non-numeric parameters</h4><p>Here, we can see that Cruise_line, which we were told is an important parameter, is an string variable. This is a problem! ML algorithms work better with numbers, as it is unclear how to process a string. ¿The solution? We can index the Cruise_line!</p><p>Source: <a href=https://stackoverflow.com/questions/36942233/apply-stringindexer-to-several-columns-in-a-pyspark-dataframe>Stack Overflow</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> pyspark.ml <span style=color:#f92672>import</span> Pipeline
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pyspark.ml.feature <span style=color:#f92672>import</span> StringIndexer
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#Bonus! Change this code to index multiple columns at once!</span>
</span></span><span style=display:flex><span>indexers <span style=color:#f92672>=</span> [StringIndexer(inputCol<span style=color:#f92672>=</span>column, outputCol<span style=color:#f92672>=</span>column<span style=color:#f92672>+</span><span style=color:#e6db74>&#34;_index&#34;</span>)<span style=color:#f92672>.</span>fit(df) <span style=color:#66d9ef>for</span> column <span style=color:#f92672>in</span> list([<span style=color:#e6db74>&#34;Cruise_line&#34;</span>]) ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>pipeline <span style=color:#f92672>=</span> Pipeline(stages<span style=color:#f92672>=</span>indexers)
</span></span><span style=display:flex><span>df_indexed <span style=color:#f92672>=</span> pipeline<span style=color:#f92672>.</span>fit(df)<span style=color:#f92672>.</span>transform(df)
</span></span><span style=display:flex><span>df_indexed<span style=color:#f92672>.</span>describe()<span style=color:#f92672>.</span>toPandas()
</span></span></code></pre></div><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}<pre><code>.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</code></pre><p></style></p><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>summary</th><th>Ship_name</th><th>Cruise_line</th><th>Age</th><th>Tonnage</th><th>passengers</th><th>length</th><th>cabins</th><th>passenger_density</th><th>crew</th><th>Cruise_line_index</th></tr></thead><tbody><tr><th>0</th><td>count</td><td>158</td><td>158</td><td>158</td><td>158</td><td>158</td><td>158</td><td>158</td><td>158</td><td>158</td><td>158</td></tr><tr><th>1</th><td>mean</td><td>Infinity</td><td>None</td><td>15.689873417721518</td><td>71.28467088607599</td><td>18.45740506329114</td><td>8.130632911392404</td><td>8.830000000000005</td><td>39.90094936708861</td><td>7.794177215189873</td><td>5.063291139240507</td></tr><tr><th>2</th><td>stddev</td><td>None</td><td>None</td><td>7.615691058751413</td><td>37.229540025907866</td><td>9.677094775143416</td><td>1.793473548054825</td><td>4.4714172221480615</td><td>8.63921711391542</td><td>3.503486564627034</td><td>4.758744608182735</td></tr><tr><th>3</th><td>min</td><td>Adventure</td><td>Azamara</td><td>4</td><td>2.329</td><td>0.66</td><td>2.79</td><td>0.33</td><td>17.7</td><td>0.59</td><td>0.0</td></tr><tr><th>4</th><td>max</td><td>Zuiderdam</td><td>Windstar</td><td>48</td><td>220.0</td><td>54.0</td><td>11.82</td><td>27.0</td><td>71.43</td><td>21.0</td><td>19.0</td></tr></tbody></table></div><h4 id=plotting-a-scatter-matrix>Plotting a scatter matrix</h4><p>Of course, the mean and stdev values for Cruise_line_index are pointless, since they just represent the Cruise Operator Company; BUT! they help us understand the data, since we can now use pandas to do a quick check among numeric variables, and see if they are related or not (source: <a href=https://towardsdatascience.com/building-a-linear-regression-with-pyspark-and-mllib-d065c3ba246a>TowardsDataScience</a>)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd
</span></span><span style=display:flex><span><span style=color:#75715e>#Fun but interesting fact: if you add &#34;;&#34; at the end of your command, you dont get matplotlib axes warnings! Yuhuuu!</span>
</span></span><span style=display:flex><span>pd<span style=color:#f92672>.</span>plotting<span style=color:#f92672>.</span>scatter_matrix(df_indexed<span style=color:#f92672>.</span>toPandas(), figsize<span style=color:#f92672>=</span>(<span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>10</span>));
</span></span></code></pre></div><p><img src=Consulting_Project_Predicting_Crew_Members_files/Consulting_Project_Predicting_Crew_Members_8_0.png alt=png></p><p>We can see that there are some variables which show very good correlation between them, such as passenger number and number of cabins; this makes sense, and can be used as &ldquo;intuitive proof&rdquo; that we are doing something correctly.</p><p>With regard to our parameter of interest, crew, we see that it seems to be most closely relate to tonnage and number of cabins, another common sense, intuitive deduction, since bigger ships need more crew to manage them and to guide the customers.</p><p>Crusise_line index doesnt seem to be very related to crew, but this could be an artifact caused by the ordering of the data in decreasing order of Cruse_line_index in the graph; with numeric correlation, a similar problem could arise, since, for potential correlation, we would expect the highest index (19) to have highest values. I will thus continue using the parameter on the model, as I was asked, and see what happens :p</p><h4 id=generating-a-ml-model>Generating a ML Model</h4><p>Now that we have done an initial exploratory analysis on the data, lets try to generate a ML model using pyspark that tells us which characteristics here are most important:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> pyspark.ml.feature <span style=color:#f92672>import</span> VectorAssembler
</span></span><span style=display:flex><span><span style=color:#75715e>#By using a list comprehension we can define inputcols as the exclusion of some columns from df_indexed</span>
</span></span><span style=display:flex><span>assembler <span style=color:#f92672>=</span> VectorAssembler(inputCols<span style=color:#f92672>=</span> [e <span style=color:#66d9ef>for</span> e <span style=color:#f92672>in</span> df_indexed<span style=color:#f92672>.</span>columns <span style=color:#66d9ef>if</span> e <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> (<span style=color:#e6db74>&#39;Ship_name&#39;</span>, <span style=color:#e6db74>&#39;Cruise_line&#39;</span>, <span style=color:#e6db74>&#39;crew&#39;</span>)]  , outputCol<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;features&#39;</span>, 
</span></span><span style=display:flex><span>                            handleInvalid<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;skip&#39;</span>)
</span></span><span style=display:flex><span>output <span style=color:#f92672>=</span> assembler<span style=color:#f92672>.</span>transform(df_indexed)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> pyspark.ml.feature <span style=color:#f92672>import</span> Imputer
</span></span><span style=display:flex><span>imputer <span style=color:#f92672>=</span> Imputer(inputCols<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;crew&#39;</span>], outputCols<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;label&#39;</span>], strategy<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;mean&#39;</span>)
</span></span><span style=display:flex><span>imputer_model <span style=color:#f92672>=</span> imputer<span style=color:#f92672>.</span>fit(output)
</span></span><span style=display:flex><span>output <span style=color:#f92672>=</span> imputer_model<span style=color:#f92672>.</span>transform(output)
</span></span></code></pre></div><p>Just to be sure everything went correctly in our pipeline, lets show the output dataframe:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>output<span style=color:#f92672>.</span>show()
</span></span></code></pre></div><pre><code>+-----------+-----------+---+------------------+----------+------+------+-----------------+----+-----------------+--------------------+-----+
|  Ship_name|Cruise_line|Age|           Tonnage|passengers|length|cabins|passenger_density|crew|Cruise_line_index|            features|label|
+-----------+-----------+---+------------------+----------+------+------+-----------------+----+-----------------+--------------------+-----+
|    Journey|    Azamara|  6|30.276999999999997|      6.94|  5.94|  3.55|            42.64|3.55|             16.0|[6.0,30.276999999...| 3.55|
|      Quest|    Azamara|  6|30.276999999999997|      6.94|  5.94|  3.55|            42.64|3.55|             16.0|[6.0,30.276999999...| 3.55|
|Celebration|   Carnival| 26|            47.262|     14.86|  7.22|  7.43|             31.8| 6.7|              1.0|[26.0,47.262,14.8...|  6.7|
|   Conquest|   Carnival| 11|             110.0|     29.74|  9.53| 14.88|            36.99|19.1|              1.0|[11.0,110.0,29.74...| 19.1|
|    Destiny|   Carnival| 17|           101.353|     26.42|  8.92| 13.21|            38.36|10.0|              1.0|[17.0,101.353,26....| 10.0|
|    Ecstasy|   Carnival| 22|            70.367|     20.52|  8.55|  10.2|            34.29| 9.2|              1.0|[22.0,70.367,20.5...|  9.2|
|    Elation|   Carnival| 15|            70.367|     20.52|  8.55|  10.2|            34.29| 9.2|              1.0|[15.0,70.367,20.5...|  9.2|
|    Fantasy|   Carnival| 23|            70.367|     20.56|  8.55| 10.22|            34.23| 9.2|              1.0|[23.0,70.367,20.5...|  9.2|
|Fascination|   Carnival| 19|            70.367|     20.52|  8.55|  10.2|            34.29| 9.2|              1.0|[19.0,70.367,20.5...|  9.2|
|    Freedom|   Carnival|  6|110.23899999999999|      37.0|  9.51| 14.87|            29.79|11.5|              1.0|[6.0,110.23899999...| 11.5|
|      Glory|   Carnival| 10|             110.0|     29.74|  9.51| 14.87|            36.99|11.6|              1.0|[10.0,110.0,29.74...| 11.6|
|    Holiday|   Carnival| 28|            46.052|     14.52|  7.27|  7.26|            31.72| 6.6|              1.0|[28.0,46.052,14.5...|  6.6|
|Imagination|   Carnival| 18|            70.367|     20.52|  8.55|  10.2|            34.29| 9.2|              1.0|[18.0,70.367,20.5...|  9.2|
|Inspiration|   Carnival| 17|            70.367|     20.52|  8.55|  10.2|            34.29| 9.2|              1.0|[17.0,70.367,20.5...|  9.2|
|     Legend|   Carnival| 11|              86.0|     21.24|  9.63| 10.62|            40.49| 9.3|              1.0|[11.0,86.0,21.24,...|  9.3|
|   Liberty*|   Carnival|  8|             110.0|     29.74|  9.51| 14.87|            36.99|11.6|              1.0|[8.0,110.0,29.74,...| 11.6|
|    Miracle|   Carnival|  9|              88.5|     21.24|  9.63| 10.62|            41.67|10.3|              1.0|[9.0,88.5,21.24,9...| 10.3|
|   Paradise|   Carnival| 15|            70.367|     20.52|  8.55|  10.2|            34.29| 9.2|              1.0|[15.0,70.367,20.5...|  9.2|
|      Pride|   Carnival| 12|              88.5|     21.24|  9.63| 11.62|            41.67| 9.3|              1.0|[12.0,88.5,21.24,...|  9.3|
|  Sensation|   Carnival| 20|            70.367|     20.52|  8.55|  10.2|            34.29| 9.2|              1.0|[20.0,70.367,20.5...|  9.2|
+-----------+-----------+---+------------------+----------+------+------+-----------------+----+-----------------+--------------------+-----+
only showing top 20 rows
</code></pre><p>Nice! As we can see, we have all our expected columns (the ones in the matrix except those in the list comprehension), and two new ones: features, which is what Spark will use for its ML approach, and label, which is populated with the crew values and will help us predict it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#Lets select the data we want to use:</span>
</span></span><span style=display:flex><span>final_data <span style=color:#f92672>=</span> output<span style=color:#f92672>.</span>select([<span style=color:#e6db74>&#39;features&#39;</span>, <span style=color:#e6db74>&#39;label&#39;</span>])
</span></span></code></pre></div><p>We can now divide the data in two: a training dataset and a test dataset, which will be used to validate the conclussions of our trained data. For the process to work, sampling has to be random, so that no undue influence is exerted through data selection (say, if we picked the first 20 values); and, the data has to be divided somehow: here, we create an 65/35 split because I felt like 70/30 left too few individuals in the test data category</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>train_data, test_data <span style=color:#f92672>=</span> final_data<span style=color:#f92672>.</span>randomSplit([<span style=color:#ae81ff>0.65</span>, <span style=color:#ae81ff>0.35</span>])
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>final_data<span style=color:#f92672>.</span>describe()<span style=color:#f92672>.</span>show(), train_data<span style=color:#f92672>.</span>describe()<span style=color:#f92672>.</span>show(), test_data<span style=color:#f92672>.</span>describe()<span style=color:#f92672>.</span>show()
</span></span></code></pre></div><pre><code>+-------+-----------------+
|summary|            label|
+-------+-----------------+
|  count|              158|
|   mean|7.794177215189873|
| stddev|3.503486564627034|
|    min|             0.59|
|    max|             21.0|
+-------+-----------------+

+-------+------------------+
|summary|             label|
+-------+------------------+
|  count|               104|
|   mean| 7.825096153846162|
| stddev|3.4947555702107467|
|    min|               0.6|
|    max|              21.0|
+-------+------------------+

+-------+------------------+
|summary|             label|
+-------+------------------+
|  count|                54|
|   mean|  7.73462962962963|
| stddev|3.5523607420094137|
|    min|              0.59|
|    max|              13.6|
+-------+------------------+






(None, None, None)
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#We import the ML Linear Regression module and stablish the label</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pyspark.ml.regression <span style=color:#f92672>import</span> LinearRegression
</span></span><span style=display:flex><span>lr <span style=color:#f92672>=</span> LinearRegression(labelCol<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;label&#39;</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>lr_model <span style=color:#f92672>=</span> lr<span style=color:#f92672>.</span>fit(train_data)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>test_results <span style=color:#f92672>=</span> lr_model<span style=color:#f92672>.</span>evaluate(test_data)
</span></span></code></pre></div><h4 id=cheking-the-results-of-the-model>Cheking the results of the model</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#The residuals for an observation is the difference between the observation (the y-value) and the fitted line.</span>
</span></span><span style=display:flex><span>test_results<span style=color:#f92672>.</span>residuals<span style=color:#f92672>.</span>show()
</span></span><span style=display:flex><span><span style=color:#75715e>#And the root Mean Squared Error is a meassure of accuracy</span>
</span></span><span style=display:flex><span>test_results<span style=color:#f92672>.</span>rootMeanSquaredError
</span></span></code></pre></div><pre><code>+--------------------+
|           residuals|
+--------------------+
| -1.3259944983423733|
| -0.8514434688157184|
| 0.25203246173775007|
| -0.5786778245997795|
| 0.17444151538670027|
| -1.3832902288430144|
| -0.8158551082693961|
| -0.4427713845911221|
|  0.3604712596502839|
| -0.6603995683195034|
|-0.25945919107257787|
|  0.3813308210539432|
| -0.7477823634981888|
|  0.6855294216709122|
| -0.6200715933698913|
| -0.7413835788890388|
| -0.6541795737066902|
|  0.9199379275910768|
|  0.9199379275910768|
| -0.4181630087049122|
+--------------------+
only showing top 20 rows






0.6939264035154783
</code></pre><p>Well&mldr; it seems like we dont get reeeealy good values. Lets check the R² just in case&mldr;</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>test_results<span style=color:#f92672>.</span>r2
</span></span></code></pre></div><pre><code>0.9611214023707688
</code></pre><p>Woah! That&rsquo;s a big R² !I guess our results were not so bad after all!!</p><p>Lets see the predictions then!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>lr_model<span style=color:#f92672>.</span>transform(test_data)<span style=color:#f92672>.</span>show()
</span></span></code></pre></div><pre><code>+--------------------+-----+------------------+
|            features|label|        prediction|
+--------------------+-----+------------------+
|[5.0,86.0,21.04,9...|  8.0| 9.325994498342373|
|[6.0,30.276999999...| 3.55| 4.401443468815718|
|[6.0,110.23899999...| 11.5| 11.24796753826225|
|[6.0,112.0,38.0,9...| 10.9| 11.47867782459978|
|[6.0,113.0,37.82,...| 12.0|  11.8255584846133|
|[7.0,89.6,25.5,9....| 9.87|11.253290228843014|
|[7.0,116.0,31.0,9...| 12.0|12.815855108269396|
|[7.0,158.0,43.7,1...| 13.6|14.042771384591122|
|[8.0,77.499,19.5,...|  9.0| 8.639528740349716|
|[8.0,110.0,29.74,...| 11.6|12.260399568319503|
|[9.0,59.058,17.0,...|  7.4| 7.659459191072578|
|[9.0,81.0,21.44,9...| 10.0| 9.618669178946057|
|[9.0,85.0,19.68,9...| 8.69| 9.437782363498188|
|[9.0,88.5,21.24,9...| 10.3| 9.614470578329088|
|[9.0,90.09,25.01,...| 8.69|  9.31007159336989|
|[9.0,105.0,27.2,8...|10.68|11.421383578889039|
|[9.0,110.0,29.74,...| 11.6| 12.25417957370669|
|[9.0,113.0,26.74,...|12.38|11.460062072408924|
|[9.0,113.0,26.74,...|12.38|11.460062072408924|
|[10.0,81.76899999...| 8.42| 8.838163008704912|
+--------------------+-----+------------------+
only showing top 20 rows
</code></pre><h4 id=trying-to-improve-the-model>Trying to improve the model</h4><p>Thats it! We have a LR, ML model that accurately (0.96) predicts the number of crew members in a Cruise ship. However, ¿could we do better? If we look back at the scatter matrix, we see that some values related better to crew than others. By excluding them, could we increase the models accuracy?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>pd<span style=color:#f92672>.</span>plotting<span style=color:#f92672>.</span>scatter_matrix(df_indexed<span style=color:#f92672>.</span>toPandas(), figsize<span style=color:#f92672>=</span>(<span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>10</span>));
</span></span></code></pre></div><p><img src=Consulting_Project_Predicting_Crew_Members_files/Consulting_Project_Predicting_Crew_Members_29_0.png alt=png></p><p>Lets try to remove passenger_density, Age and Cruise_line_index (even though yes, we were told this was an important parameter for the company) and see what happens:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>assembler <span style=color:#f92672>=</span> VectorAssembler(inputCols<span style=color:#f92672>=</span> [e <span style=color:#66d9ef>for</span> e <span style=color:#f92672>in</span> df_indexed<span style=color:#f92672>.</span>columns <span style=color:#66d9ef>if</span> e <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> (<span style=color:#e6db74>&#39;Ship_name&#39;</span>, <span style=color:#e6db74>&#39;Cruise_line&#39;</span>, 
</span></span><span style=display:flex><span>                                                                                   <span style=color:#e6db74>&#39;crew&#39;</span>, <span style=color:#e6db74>&#39;passenger_density&#39;</span>, <span style=color:#e6db74>&#39;Age&#39;</span>, <span style=color:#e6db74>&#39;Cruise_line_index&#39;</span>)]  , outputCol<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;features&#39;</span>, 
</span></span><span style=display:flex><span>                            handleInvalid<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;skip&#39;</span>)
</span></span><span style=display:flex><span>output <span style=color:#f92672>=</span> assembler<span style=color:#f92672>.</span>transform(df_indexed)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>imputer <span style=color:#f92672>=</span> Imputer(inputCols<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;crew&#39;</span>], outputCols<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;label&#39;</span>], strategy<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;mean&#39;</span>)
</span></span><span style=display:flex><span>imputer_model <span style=color:#f92672>=</span> imputer<span style=color:#f92672>.</span>fit(output)
</span></span><span style=display:flex><span>output <span style=color:#f92672>=</span> imputer_model<span style=color:#f92672>.</span>transform(output)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>final_data <span style=color:#f92672>=</span> output<span style=color:#f92672>.</span>select([<span style=color:#e6db74>&#39;features&#39;</span>, <span style=color:#e6db74>&#39;label&#39;</span>])
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>train_data, test_data <span style=color:#f92672>=</span> final_data<span style=color:#f92672>.</span>randomSplit([<span style=color:#ae81ff>0.65</span>, <span style=color:#ae81ff>0.35</span>])
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>lr <span style=color:#f92672>=</span> LinearRegression(labelCol<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;label&#39;</span>)
</span></span><span style=display:flex><span>lr_model <span style=color:#f92672>=</span> lr<span style=color:#f92672>.</span>fit(train_data)
</span></span><span style=display:flex><span>test_results <span style=color:#f92672>=</span> lr_model<span style=color:#f92672>.</span>evaluate(test_data)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>test_results<span style=color:#f92672>.</span>residuals<span style=color:#f92672>.</span>show(), test_results<span style=color:#f92672>.</span>rootMeanSquaredError, test_results<span style=color:#f92672>.</span>r2
</span></span></code></pre></div><pre><code>+--------------------+
|           residuals|
+--------------------+
| -0.8231610867408612|
| -0.2639915612753747|
| -0.1339915612753746|
| -0.1943057005996871|
|-0.22359048492732336|
|-0.41929365405413854|
| 0.01972284792550294|
|-0.05123127867500...|
| 0.08804027838669004|
|-0.09625319517634523|
| -0.2464422157023174|
|  0.6476692405794164|
| 0.11971319676579384|
|  1.2077329156434358|
|  0.2875155279976793|
| -1.0783646108913167|
| -0.1617301231003614|
| -0.1617301231003614|
| -0.6314669369748263|
|-0.44057575750874367|
+--------------------+
only showing top 20 rows






(None, 0.9260213023938995, 0.9148216903559475)
</code></pre><p>Wow! When we do this supposed &ldquo;optimisation&rdquo; of the model, we can see that, while the R² is not so different (0.91 vs 0.96, an <strong>acceptable</strong> decrease), the RMSD grows <strong>massively</strong> (from 0.69 to 0.92). And, given that <strong>an smaller RMSD is better</strong> this change in the model can be deemed unacceptable: all the characteristics <strong>together</strong> predict crew members better that when taking some of them out.</p><p>A PCA approach could help us define which parameters are the most important for the model in a more &lsquo;mathematic&rsquo; way, but, for the time being, we will keep the first model: an R² of 0.96 is good enough, I believe.</p></div><div class="row pl-3 pr-3"><div class="col-md-6 share-buttons"><strong>Compartir en:</strong>
<a class="btn btn-sm facebook-btn" href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fwww.pablomarcos.me%2fes%2fposts%2fmaster-en-biolog%25C3%25ADa-computacional%2fbig-data%2fpredicting-crew-members%2f" target=_blank><i class="fab fa-facebook"></i></a>
<a class="btn btn-sm twitter-btn" href="https://twitter.com/share?url=https%3a%2f%2fwww.pablomarcos.me%2fes%2fposts%2fmaster-en-biolog%25C3%25ADa-computacional%2fbig-data%2fpredicting-crew-members%2f&text=Predicting%20Crew%20Members&via=Pablo%20Marcos%27%20Blog" target=_blank><i class="fab fa-twitter"></i></a>
<a class="btn btn-sm reddit-btn" href="https://reddit.com/submit?url=https%3a%2f%2fwww.pablomarcos.me%2fes%2fposts%2fmaster-en-biolog%25C3%25ADa-computacional%2fbig-data%2fpredicting-crew-members%2f&title=Predicting%20Crew%20Members" target=_blank><i class="fab fa-reddit"></i></a>
<a class="btn btn-sm tumblr-btn" href="https://www.tumblr.com/share/link?url=https%3a%2f%2fwww.pablomarcos.me%2fes%2fposts%2fmaster-en-biolog%25C3%25ADa-computacional%2fbig-data%2fpredicting-crew-members%2f&name=Predicting%20Crew%20Members" target=_blank><i class="fab fa-tumblr"></i></a>
<a class="btn btn-sm pocket-btn" href="https://getpocket.com/save?url=https%3a%2f%2fwww.pablomarcos.me%2fes%2fposts%2fmaster-en-biolog%25C3%25ADa-computacional%2fbig-data%2fpredicting-crew-members%2f&title=Predicting%20Crew%20Members" target=_blank><i class="fab fa-get-pocket"></i></a>
<a class="btn btn-sm linkedin-btn" href="https://www.linkedin.com/shareArticle?url=https%3a%2f%2fwww.pablomarcos.me%2fes%2fposts%2fmaster-en-biolog%25C3%25ADa-computacional%2fbig-data%2fpredicting-crew-members%2f&title=Predicting%20Crew%20Members" target=_blank><i class="fab fa-linkedin"></i></a>
<a class="btn btn-sm diaspora-btn" href="https://share.diasporafoundation.org/?title=Predicting%20Crew%20Members&url=https%3a%2f%2fwww.pablomarcos.me%2fes%2fposts%2fmaster-en-biolog%25C3%25ADa-computacional%2fbig-data%2fpredicting-crew-members%2f" rel=nofollow target=_blank><i class="fab fa-diaspora"></i></a>
<a class="btn btn-sm mastodon-btn" href="https://mastodon.social/share?text=Predicting%20Crew%20Members - https%3a%2f%2fwww.pablomarcos.me%2fes%2fposts%2fmaster-en-biolog%25C3%25ADa-computacional%2fbig-data%2fpredicting-crew-members%2f" target=_blank><i class="fab fa-mastodon"></i></a>
<a class="btn btn-sm whatsapp-btn" href="https://api.whatsapp.com/send?text=Predicting%20Crew%20Members https%3a%2f%2fwww.pablomarcos.me%2fes%2fposts%2fmaster-en-biolog%25C3%25ADa-computacional%2fbig-data%2fpredicting-crew-members%2f" target=_blank><i class="fab fa-whatsapp"></i></a>
<a class="btn btn-sm email-btn" href="mailto:?subject=Predicting%20Crew%20Members&body=https%3a%2f%2fwww.pablomarcos.me%2fes%2fposts%2fmaster-en-biolog%25C3%25ADa-computacional%2fbig-data%2fpredicting-crew-members%2f" target=_blank><i class="fas fa-envelope-open-text"></i></a></div><div class="col-md-6 btn-improve-page"><a href=https://codeberg.org/FlyingFlamingo/pablomarcos.me/_edit/main/content/posts/Master%20en%20Biolog%c3%ada%20Computacional/Big%20Data/Predicting%20Crew%20Members/index.es.md title="Mejorar esta página" target=_blank rel=noopener><i class="fas fa-code-branch"></i>
Mejorar esta página</a></div></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/es/posts/master-en-biolog%C3%ADa-computacional/big-data/predicting-churn-risk/ title="Predicting Churn Risk" class="btn btn-outline-info"><div><i class="fas fa-chevron-circle-left"></i> Anterior</div><div class=next-prev-text>Predicting Churn Risk</div></a></div><div class="col-md-6 next-article"><a href=/es/posts/master-en-biolog%C3%ADa-computacional/big-data/walmart-stock-exercise/ title="Walmart Stock Exercise" class="btn btn-outline-info"><div>Siguiente <i class="fas fa-chevron-circle-right"></i></div><div class=next-prev-text>Walmart Stock Exercise</div></a></div></div><hr></div></div></div><a id=scroll-to-top class=btn><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Contenido</h5><hr><div class=toc><nav id=TableOfContents><ul><li><ul><li><ul><li><a href=#create-the-spark-session>Create the Spark Session</a></li><li><a href=#read-the-file-and-inspect-it>Read the file and inspect it</a></li><li><a href=#indexing-non-numeric-parameters>Indexing non-numeric parameters</a></li><li><a href=#plotting-a-scatter-matrix>Plotting a scatter matrix</a></li><li><a href=#generating-a-ml-model>Generating a ML Model</a></li><li><a href=#cheking-the-results-of-the-model>Cheking the results of the model</a></li><li><a href=#trying-to-improve-the-model>Trying to improve the model</a></li></ul></li></ul></li></ul></nav></div></div></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navegación</h5><ul><li class=nav-item><a class=smooth-scroll href=https://www.pablomarcos.me/es/#about>Sobre mí</a></li><li class=nav-item><a class=smooth-scroll href=https://www.pablomarcos.me/es/#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=https://www.pablomarcos.me/es/#experiences>Experiencia</a></li><li class=nav-item><a class=smooth-scroll href=https://www.pablomarcos.me/es/#education>Education</a></li><li class=nav-item><a class=smooth-scroll href=https://www.pablomarcos.me/es/#projects>Proyectos</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contacto</h5><ul><li><a href=mailto:web@pablomarcos.me target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span> <span>web@pablomarcos.me</span></a></li></ul></div><div class="col-md-4 col-sm-12"><p>Subscribirse</p><form method=post action=https://blogtrottr.com><div class=form-group><input type=email class=form-control name=btr_email placeholder="Ingrese email"><br><input type=hidden name=btr_url value=https://www.pablomarcos.me/es/index.xml>
<input type=hidden name=schedule_type value=1>
<small id=emailHelp class="form-text text-muted">Al ingresar su dirección de correo electrónico, acepta recibir el boletín de este sitio web.</small>
<button type=submit class="btn btn-info"> Enviar</button></div></form></div></div></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hugo-toha/toha target=_blank rel=noopener><img src=/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_3.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">© 2020 Pablo Ignacio Marcos López</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Funcionando con
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script type=text/javascript src=/js/jquery-3.4.1.min.js></script>
<script type=text/javascript src=/js/popper.min.js></script>
<script type=text/javascript src=/js/bootstrap.min.js></script>
<script type=text/javascript src=/js/navbar.js></script>
<script type=text/javascript src=/js/plyr.js></script>
<script type=text/javascript src=/js/main.js></script>
<script type=text/javascript src=/js/darkreader.js></script>
<script type=text/javascript src=/js/darkmode-darkreader.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script>
<script src=/js/single.js></script>
<script>hljs.initHighlightingOnLoad()</script><link rel=stylesheet href=/katex/katex.min.css><script type=text/javascript defer src=/katex/katex.min.js></script>
<script type=text/javascript defer src=/katex/auto-render.min.js onload=renderMathInElement(document.body)>renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1}]})</script><script src=https://storage.ko-fi.com/cdn/scripts/overlay-widget.js></script>
<script>kofiWidgetOverlay.draw("pablomarcos",{type:"floating-chat","floating-chat.donateButton.text":"Apóyame","floating-chat.donateButton.text-color":"#fff","floating-chat.donateButton.background-color":"#00b9fe"})</script></body></html>